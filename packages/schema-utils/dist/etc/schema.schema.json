{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "description": "A representation of a schema for use by polygraph",
    "type": "object",
    "required": ["resources"],
    "properties": {
        "title": {
            "type": "string",
            "description": "The schema's title"
        },
        "meta": {},
        "resources": {
            "type": "object",
            "patternProperties": {
                ".*": {
                    "$ref": "#/definitions/resource"
                }
            },
            "minProperties": 1,
            "propertyNames": { "pattern": "^([a-z])([A-Za-z0-9_]+)$" }
        }
    },
    "definitions": {
        "resource": {
            "type": "object",
            "properties": {
                "singular": { "type": "string" },
                "attributes": {
                    "$ref": "#attributes"
                },
                "relationships": {
                    "$ref": "#/definitions/relationships"
                },
                "meta": {}
            },
            "required": ["attributes", "relationships"]
        },
        "attributes": {
            "$id": "#attributes",
            "type": "object",
            "patternProperties": {
                "^([a-z])([A-Za-z0-9_]+)$": {
                    "type": "object",
                    "properties": {
                        "type": {
                            "$ref": "#attributeType"
                        },
                        "meta": {}
                    },
                    "required": ["type"]
                }
            },
            "minProperties": 1,
            "propertyNames": { "pattern": "^([a-z])([A-Za-z0-9_]+)$" }
        },
        "relationships": {
            "type": "object",
            "patternProperties": {
                "^([a-z])([A-Za-z0-9_]+)$": {
                    "oneOf": [
                        {
                            "type": "object",
                            "properties": {
                                "type": { "type": "string" },
                                "cardinality": { "enum": ["one", "many"] },
                                "inverse": { "type": "string" }
                            },
                            "required": ["type", "cardinality", "inverse"]
                        }, {
                            "type": "object",
                            "properties": {
                                "type": { "type": "string" },
                                "cardinality": { "enum": ["one", "many"] },
                                "inverses": {
                                    "type": "array",
                                    "properties": { "items": { "type": "string" } }
                                }
                            },
                            "required": ["type", "cardinality", "inverses"]
                        }
                    ]
                }
            },
            "propertyNames": { "pattern": "^([a-z])([A-Za-z0-9_]+)$" }
        },
        "attributeType": {
            "$id": "#attributeType",
            "oneOf": [
                { "enum": ["boolean", "date", "datetime", "integer", "number", "string", "text", "uuid"] },
                { "type": "array", "minItems": 1, "maxItems": 1, "items": { "$ref": "#attributeType" } },
                {
                    "type": "object",
                    "patternProperties": {
                        "^([a-z])([A-Za-z0-9_]+)$": {
                            "type": "object",
                            "properties": {
                                "type": {
                                    "$ref": "#attributeType"
                                },
                                "meta": {}
                            },
                            "required": ["type"]
                        }
                    },
                    "minProperties": 1,
                    "propertyNames": { "pattern": "^([a-z])([A-Za-z0-9_]+)$" }
                }
            ]
        }
    }
}
